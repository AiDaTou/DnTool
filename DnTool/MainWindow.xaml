<Controls:MetroWindow x:Class="DnTool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:Controls="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:uc="clr-namespace:DnTool.Views"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        Title="DnTool V1.0" Height="627.202" Width="378.732" Loaded="MetroWindow_Loaded">
       <i:Interaction.Triggers>
         <i:EventTrigger EventName="Closed">
            <i:InvokeCommandAction Command="{Binding ClosedCommand}" />
         </i:EventTrigger>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/DnTool;component/Resources/Icons.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <Ellipse x:Key="AccentMenuIcon"
                     x:Shared="False"
                     Width="16"
                     Height="16"
                     Fill="{Binding ColorBrush, Mode=OneWay}" />
            <Style x:Key="AccentColorMenuItemStyle"
                   TargetType="{x:Type MenuItem}"
                   BasedOn="{StaticResource MetroMenuItem}">
                <Setter Property="Command"
                        Value="{Binding ChangeAccentCommand}" />
                <Setter Property="Icon"
                        Value="{StaticResource AccentMenuIcon}" />
                <Setter Property="Header"
                        Value="{Binding Name, Mode=OneWay}" />
            </Style>
        </ResourceDictionary>
    </Window.Resources>
    <Controls:MetroWindow.RightWindowCommands>

        <Controls:WindowCommands>
            <Button Content="设置" Click="ShowSettings"/>
        </Controls:WindowCommands>
    </Controls:MetroWindow.RightWindowCommands>


    <Controls:MetroWindow.Flyouts>
        <Controls:FlyoutsControl>
            <Controls:Flyout x:Name="settingsFlyout"
                             Margin="100 0 0 0"
                             Width="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=Controls:MetroWindow}, Path=ActualWidth}"
                             Header="设置"
                             Position="Right"
                             IsModal="True"
                             Theme="Accent">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                  
                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto">
                        <StackPanel Orientation="Vertical">
                            <Controls:ToggleSwitch  Content="窗体置顶" IsChecked="{Binding Topmost,RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type Window}}}"/>
                            <ComboBox ItemsSource="{Binding AccentColors, Mode=OneWay}" ItemContainerStyle="{StaticResource AccentColorMenuItemStyle}"></ComboBox>
                        </StackPanel>
                    </ScrollViewer>
                    <UniformGrid Columns="2"
                                 Grid.Row="2"
                                 Margin="10">
                        <Button Style="{DynamicResource SquareButtonStyle}"
                                Margin="10"
                                Content="Create" />
                        <Button Style="{DynamicResource SquareButtonStyle}"
                                Margin="10"
                                Content="Cancel" />
                    </UniformGrid>
                </Grid>

            </Controls:Flyout>
        </Controls:FlyoutsControl>
    </Controls:MetroWindow.Flyouts>







    <Grid>
        <StackPanel>
        <WrapPanel Margin="0,20,0,0">
            <Label>当前坐标:</Label>
            <Label>X:</Label>
            <Label Width="55" Foreground="Red" Content="{Binding X}"></Label>
            <Label>Y:</Label>
            <Label Width="55" Foreground="Red" Content="{Binding Y}"></Label>
            <Label>Z:</Label>
            <Label Width="55" Foreground="Red" Content="{Binding Z}"></Label>
            <Button Content="保存坐标" Command="{Binding SavePointCommand}"/>
        </WrapPanel>
        
         <WrapPanel Margin="0,20,0,0" Height="38">
                <Canvas HorizontalAlignment="Left" Width="30" Height="21" Margin="10,0,0,0" VerticalAlignment="Top">
                    <Image x:Name="image1" MouseDown="Image_MouseDown" MouseUp="Image_MouseUp"/>
                </Canvas>
                <ComboBox HorizontalAlignment="Left" Margin="50,0,0,0" VerticalAlignment="Top" Width="120" ItemsSource="{Binding FileNames}" SelectedValue="{Binding SelectedPath}" DisplayMemberPath="Name" SelectedValuePath="Path"/>
            <Button Content="添加坐标" HorizontalAlignment="Left" Margin="10,0,0,0"  VerticalAlignment="Top" Width="75"/>
                
         </WrapPanel>
            <DockPanel Height="420">
                <WrapPanel Height="30" DockPanel.Dock="Top">
                    <Button Width="80" Height="30" Content="多开" ToolTip="开一个窗口点一下按钮" Command="{Binding OpenCommand}"></Button>
                    <Button Width="80" Content="键盘测试" Command="{Binding TestCommand}"></Button>
                    <Button Width="80" Content="解绑" Command="{Binding UnBindCommand}"></Button>
                </WrapPanel>
                
                <DataGrid x:Name="dg" HeadersVisibility="All" DockPanel.Dock="Right" HorizontalAlignment="Left" Height="320"  VerticalAlignment="Top"  ItemsSource="{Binding InfoList}" HorizontalScrollBarVisibility="Disabled"  AutoGenerateColumns="False"
                          SelectedItem="{Binding SelectedPoint}" LoadingRow="DataGrid_LoadingRow"  CanUserSortColumns="False" CanUserAddRows="False" IsReadOnly="True" SelectionMode="Single" CanUserResizeColumns="False">
                    <!--<i:Interaction.Triggers>
                        <i:EventTrigger EventName="MouseDoubleClick">
                            <i:InvokeCommandAction Command="{Binding MoveCommand}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>-->
                    <DataGrid.Columns>
                        <!--<DataGridTextColumn Header="ID" Width="35" Binding="{Binding ItemIndex}"/>-->
                        <DataGridTextColumn Header="坐标名" Width="110" Binding="{Binding Name}"/>
                        <DataGridTextColumn Header="X" Width="65" Binding="{Binding CurrentPoint.X}"/>
                        <DataGridTextColumn Header="Y" Width="65" Binding="{Binding CurrentPoint.Y}"/>
                        <DataGridTextColumn Header="Z" Width="65" Binding="{Binding CurrentPoint.Z}"/>
                        <DataGridTemplateColumn Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ToggleButton Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}},Path=DataContext.MoveCommand }">
                                        <Rectangle Width="20" Height="15">
                                            <Rectangle.Fill>
                                                <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_arrow_right}" />
                                            </Rectangle.Fill>
                                        </Rectangle>
                                    </ToggleButton>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

         </DockPanel>
          
        </StackPanel>
    </Grid>
</Controls:MetroWindow>
